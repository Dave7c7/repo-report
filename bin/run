#!/usr/bin/env node
/* eslint-disable no-magic-numbers */

'use strict';

require('dotenv').config();
const Yargs = require('yargs');
const list = require('../src/commands/list');
const options = require('../src/commands/options');
const branchProtections = require('../src/commands/branch-protection');
const prStatus = require('../src/commands/pr-status');

Yargs.usage('Usage: $0 <command> [options]')
	.command('list', 'lists all repositories', function (yargs) {
		const argv = yargs
			.usage('Usage: $0 list [options]')
			.alias('g', 'group-by')
			.nargs('g', 1)
			.describe('g', 'Field to be grouped by')
			.alias('f', 'fields')
			.boolean('f')
			.describe('f', 'Show available fields')
			.help('h')
			.alias('h', 'help').argv;
		list(argv);
	})
	.command('options', 'lists option settings', function (yargs) {
		const argv = yargs
			.usage('Usage: $0 options [options]')
			.alias('g', 'group-by')
			.nargs('g', 1)
			.describe('g', 'Field to be grouped by')
			.alias('f', 'fields')
			.boolean('f')
			.describe('f', 'Show available fields')
			.help('h')
			.alias('h', 'help').argv;
		options(argv);
	})
	.command(
		'branchProtection',
		'list branch protections for default branch for all repositories',
		function (yargs) {
			const argv = yargs
				.usage('Usage: $0 branchProtection [options]')
				.alias('g', 'group-by')
				.nargs('g', 1)
				.describe('g', 'Field to be grouped by')
				.alias('f', 'fields')
				.boolean('f')
				.describe('f', 'Show available fields')
				.help('h')
				.alias('h', 'help').argv;
			branchProtections(argv);
		},
	)
	.command(
		'pr-status',
		'fetch status checks for a particular repository and a given pull request number',
		function (yargs) {
			const argv = yargs
				.usage('Usage: $0 pr-status --repo <owner/repo> --id <pr-id> [options]')
				.option('repo', {
					describe: 'the owner\'s name and the repository\'s name separated by /',
				})
				.option('id', {
					describe: 'the pull request\'s unique identifier',
				})
				.demandOption(['repo', 'id'])
				.help('h')
				.alias('h', 'help').argv;
			prStatus(argv);
		},
	)
	.help('h')
	.alias('h', 'help')
	.parse();
