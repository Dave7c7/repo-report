<!doctype html>

<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
</head>

<body>
    <div class="container">
        <div class="title">Repo Report!</div>
        <div class="instructions">
            <div>Enter Command and press Enter!</div>
            <div id='status' class="status-hide">
                <div class="loader">
                    <div></div>
                    <div></div>
                    <div></div>
                    <div></div>
                </div>
                <div class="status-text">Getting Data from Github...</div>
            </div>
        </div>

        <input class="command" type="text" name="command" id="command">
        <div class="table-container">
            <table class="table" cellspacing="0" cellpadding="0">
                <thead id="table-head" class="table-head">
                </thead>
                <tbody id='table-body'>
                </tbody>
            </table>
        </div>
    </div>
    <style>
        body {
            margin: 0;
        }

        * {
            font-family: 'Inter', sans-serif;
        }

        .status {
            display: flex;
            align-items: center;
        }

        .status-hide {
            display: none;
        }

        .loader {
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            width: 40px;
            height: 40px;
        }

        .loader div {
            box-sizing: border-box;
            display: block;
            position: absolute;
            width: 10px;
            height: 10px;
            margin: 0px;
            border: 1px solid #fff;
            border-radius: 50%;
            animation: loader 1.2s cubic-bezier(0.5, 0, 0.5, 1) infinite;
            border-color: #FF4E3D transparent transparent transparent;
        }

        .loader div:nth-child(1) {
            animation-delay: -0.45s;
        }

        .loader div:nth-child(2) {
            animation-delay: -0.3s;
        }

        .loader div:nth-child(3) {
            animation-delay: -0.15s;
        }

        @keyframes loader {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            padding: 0 5vw 0 5vw;
        }

        .td-container {
            display: flex;
            justify-content: center;
        }

        .title {
            display: flex;
            justify-content: center;
            align-items: center;
            height: auto;
            font-weight: bold;
            font-size: 36px;
            height: 10vh;
        }

        .instructions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 16px;
            width: 100%;
            height: 5vh;
        }

        .command {
            --tw-bg-opacity: 1;
            --tw-text-opacity: 1;
            width: 20rem;
            font-size: 0.75rem;
            line-height: 1rem;
            color: rgba(39, 174, 96, var(--tw-text-opacity));
            border-width: 1px;
            border-radius: 0.5rem;
            background-color: rgba(51, 51, 51, var(--tw-bg-opacity));
            margin-top: 0.75rem;
            padding-left: 1rem;
            height: 5vh;
        }

        .table-container {
            height: 70vh;
            max-width: 90vw;
            overflow: scroll;
            margin-top: 24px;
            border: 1px solid #D1CFD7;
        }

        .table {
            --tw-border-opacity: 1;
            position: relative;
            border-collapse: collapse;

        }

        .table-head {
            background-color: #F7F7FA;
        }

        .circle-green {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: #4CD964;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .circle-red {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: #FF4E3D;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        th {
            padding: 24px;
            text-align: center;
        }

        td {
            border: 1px solid #D1CFD7;
        }

        tr:nth-child(even) {
            background-color: #F7F7FA;
        }

        td:hover {
            background-color: #E0E0E0;
        }

        th {
            /* Top Row */
            background-color: #D1CFD7;
            position: sticky;
            top: 0px;
            z-index: 9;
        }

        th:first-of-type {
            /* Top Left Cell */
            left: 0;
            z-index: 10;
        }

        tbody tr td:first-of-type {
            /* Left Column */
            background-color: #D1CFD7;
            position: sticky;
            max-width: 20vw;
            overflow-wrap: break-word;
            left: 0px;
            text-align: left;
            padding: 16px;
            z-index: 5;
        }
    </style>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script>
        const executeCommand = async (command) => {
            const res = await axios.post('http://localhost:3000/command', {
                "command": command,
            });
            return res.data.output;
        }

        const handleInput = async (event) => {
            if (event.keyCode === 13) {
                event.preventDefault();
                showStatus();
                const response = await executeCommand(input.value);
                hidestatus();
                renderHead(response.metrics)
                renderBody(response.repos, response.rows)
            }
        }

        const showStatus = () => {
            let status = document.getElementById('status');
            status.classList.remove('status-hide');
            status.classList.add('status');
        }
        const hidestatus = () => {
            let status = document.getElementById('status');
            status.classList.remove('status');
            status.classList.add('status-hide');
        }

        const renderBody = (repos, rows) => {
            let tableBody = document.getElementById('table-body');
            repos.forEach((repo, i) => {
                const row = rows[i];
                let tr = document.createElement('tr');

                let left = document.createElement('td');
                left.innerHTML = repo;
                tr.appendChild(left);

                row.forEach((elem => {
                    let td = document.createElement('td');
                    let tdContainer = document.createElement('div');
                    tdContainer.classList.add('td-container');

                    let div = document.createElement('div');
                    if (elem === 1) {
                        div.classList.add('circle-green');
                    } else {
                        div.classList.add('circle-red');
                    }
                    tdContainer.appendChild(div)
                    td.appendChild(tdContainer);
                    tr.appendChild(td)
                }))
                tableBody.appendChild(tr)
            });
        }
        const renderHead = (head) => {
            let headTable = document.getElementById('table-head');
            let tr = document.createElement('tr');
            headTable.appendChild(tr);


            let th = document.createElement("th");
            th.textContent = 'Repositories/Metrics';
            tr.appendChild(th);

            head.forEach(element => {
                let th = document.createElement("th");
                th.textContent = element;
                tr.appendChild(th);
            });
        }

        let input = document.getElementById("command");
        input.addEventListener("keyup", handleInput);
    </script>
</body>

</html>